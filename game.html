<!doctype html>

    <head>
        <title>Canvas Tutorial</title>

        <head>

        <body>
            <canvas id="gameCanvas" width="500" height="500"></canvas>
            
            <script>
                
                var canvas, canvasContext;

                window.onload = function() {
                    canvas = document.getElementById('gameCanvas');
                    canvasContext = canvas.getContext('2d');

                    document.addEventListener('keydown', keyPressed);
                    document.addEventListener('keyup', keyReleased);

                    setInterval(mainloop, 1000 / 50)

                }

                var playerXpos = 0;
                var playerYpos = 0;
                var playerXspeed = 5;
                var playerYspeed = 5;
                var PLAYER_SIZE = 15;
                
                var enemyXpos = 0;
                var enemyYpos = 0;
                var enemyXspeed = 6;
                var enemyYspeed = 6;
                var ENEMY_SIZE = 20;
                

                const LEFT_KEY = 37;
                const RIGHT_KEY = 39;
                const UP_KEY = 38;
                const DOWN_KEY = 40;
                var rightKeyPressed = false;
                var leftKeyPressed = false;
                var downKeyPressed = false;
                var upKeyPressed = false;

                var score = 0;
                var totalEnemies = 10
                var  enemies = [];
                
                var enemy = new Image();
                enemy.src = 'enemy.png';
                
                var enemy1 = new Image();
                enemy1.src = 'enemy1.png';
                   
                var enemy2 = new Image();
                enemy2.src = 'enemy2.png';
                
                var enemy3 = new Image();
                enemy3.src = 'enemy3.png';
                
                var enemy4 = new Image();
                enemy4.src = 'enemy4.png';
                
                 var starting = true;
                
                var enemyPics = [enemy, enemy1, enemy2, enemy3, enemy4];      
                
                function mainloop() {
                    colorRect(0, 0, canvas.width, canvas.height, 'canvas.png');
                    colorRect(playerXpos, playerYpos, PLAYER_SIZE, PLAYER_SIZE, 'blue');
                    
//                    colorRect(enemyXpos,enemyYpos,ENEMY_SIZE,ENEMY_SIZE,'red')
                 
                    
                    playermove();
                    
                    enemyMove();
                    enemydraw();
                                        
                     
               if (starting) {
                for (var i =0; i < totalEnemies; i++) {
                    makeEnemy();
                }
                   starting= false;
                }
            }
            
            function enemydraw() {
                enemies.forEach(function(e, i, array) {
                    drawimg(e.img,e.enemyXpos, e.enemyYpos, e.ENEMY_SIZE, e.ENEMY_SIZE);
//                var enemyXpos = 0;
//                var enemyYpos = Math.floor(Math.random()*(canvas.height - ENEMY_SIZE));
//                var enemyXspeed = 6;
//                var enemyYspeed = 6;
                
                });
            }
                
            function makeEnemy(){
                var ENEMY_SIZE = 40;
                var enemyXpos = 0;
                var enemyYpos = Math.floor(Math.random()*(canvas.height - ENEMY_SIZE));
                var enemyXspeed = 6;
                var enemyYspeed = 6;
                var picRand = Math.floor(Math.random()*5);
                var img = enemyPics[picRand];
                
                var enemy = {
                    img: img,
                    enemyXpos: enemyXpos,
                    enemyYpos: enemyYpos,
                    ENEMY_SIZE: ENEMY_SIZE,
                    enemyXspeed: enemyXspeed,
                    enemyYspeed: enemyYspeed
                }
                
                enemies.push(enemy);
            }
                
//                function drawEnemy(){
//                    enemies.forEach(function(enemy, i){
// colorRect(enemy.enemyXpos,enemy.enemyYpos,enemy.ENEMY_SIZE,enemy.ENEMY_SIZE,)
//                 
//                    });
//                    
//                }
//                
                
                
                
                
                
                function enemyMove(){
                    enemies.forEach(function(enemy){
                        
                    
                    enemy.enemyXpos += enemy.enemyXspeed;
                    
                    if(enemy.enemyXpos > canvas.width){
                        enemy.enemyXpos = 0 - enemy.ENEMY_SIZE;
                        
                         enemy.enemyYpos= Math.floor(Math.random() *3) + 1;
//                        enemy.enemyYpos = enemyPos * (canvas.width / 3);
                        enemy.enemyXspeed = Math.floor(Math.random() * (12 - 4) + 4);
                
                    }
                   if(enemy.enemyXpos + enemy.ENEMY_SIZE > playerXpos &&  enemy.enemyXpos < playerXpos + PLAYER_SIZE && enemy.enemyYpos + enemy.ENEMY_SIZE > playerYpos && enemy.enemyYpos < playerYpos + PLAYER_SIZE){
                       playerYpos = 0;
                       playerXpos = canvas.width - PLAYER_SIZE;
                       score++;
                       console.log('score:' + score);
                   }
               });
         }
               

                function playermove() {
                    if (rightKeyPressed) {
                        playerXpos += playerXspeed;
                    }
                    if (leftKeyPressed) {
                        playerXpos -= playerXspeed;
                    }
                    if (downKeyPressed) {
                        playerYpos += playerYspeed;
                    }
                    if (upKeyPressed) {
                        playerYpos -= playerYspeed;
                    }
                }
            
                
                function keyPressed(evt) {
                    console.log(evt.keyCode)
                    if (evt.keyCode == RIGHT_KEY) {
                        rightKeyPressed = true;
                    }
                    if (evt.keyCode == LEFT_KEY) {
                        leftKeyPressed = true;
                    }
                    if (evt.keyCode == DOWN_KEY) {
                        downKeyPressed = true; 
                    }
                    if (evt.keyCode == UP_KEY) {
                        upKeyPressed = true;
                    }
                }

                function keyReleased(evt) {
                    if (evt.keyCode == RIGHT_KEY) {
                        rightKeyPressed = false;
                    }
                    if (evt.keyCode == LEFT_KEY) {
                        leftKeyPressed = false;
                    }
                     if (evt.keyCode == DOWN_KEY) {
                        downKeyPressed = false;
                    } 
                    if (evt.keyCode == UP_KEY) {
                        upKeyPressed = false;
                    }
                    
                }
                
                function drawimg(src, x, y, w, h ) {
                    canvasContext.drawImage(src, x, y, w, h);
                }
                
                function colorRect(x, y, w, h, c) {
                    canvasContext.fillStyle = c;
                    canvasContext.fillRect(x, y, w, h, );
                }
               

            </script>
        </body>
